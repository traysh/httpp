TODO
-Use epoll for linux and kqueue for mac
